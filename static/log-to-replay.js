// Log to replay

window.TemplateHTML = atob('PCFET0NUWVBFIGh0bWw+DQo8aHRtbD4NCjxoZWFkPg0KPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+DQo8IS0tIHZlcnNpb24gMSAtLT4NCjx0aXRsZT5CYXR0bGUgUmVwbGF5PC90aXRsZT4NCjxzdHlsZT4NCmh0bWwsYm9keSB7Zm9udC1mYW1pbHk6VmVyZGFuYSwgc2Fucy1zZXJpZjtmb250LXNpemU6MTBwdDttYXJnaW46MDtwYWRkaW5nOjA7fWJvZHl7cGFkZGluZzoxMnB4IDA7fSAuYmF0dGxlLWxvZyB7Zm9udC1mYW1pbHk6VmVyZGFuYSwgc2Fucy1zZXJpZjtmb250LXNpemU6MTBwdDt9IC5iYXR0bGUtbG9nLWlubGluZSB7Ym9yZGVyOjFweCBzb2xpZCAjQUFBQUFBO2JhY2tncm91bmQ6I0VFRjJGNTtjb2xvcjpibGFjazttYXgtd2lkdGg6NjQwcHg7bWFyZ2luOjAgYXV0byA4MHB4O3BhZGRpbmctYm90dG9tOjVweDt9IC5iYXR0bGUtbG9nIC5pbm5lciB7cGFkZGluZzo0cHggOHB4IDBweCA4cHg7fSAuYmF0dGxlLWxvZyAuaW5uZXItcHJlZW1wdCB7cGFkZGluZzowIDhweCA0cHggOHB4O30gLmJhdHRsZS1sb2cgLmlubmVyLWFmdGVyIHttYXJnaW4tdG9wOjAuNWVtO30gLmJhdHRsZS1sb2cgaDIge21hcmdpbjowLjVlbSAtOHB4O3BhZGRpbmc6NHB4IDhweDtib3JkZXI6MXB4IHNvbGlkICNBQUFBQUE7YmFja2dyb3VuZDojRTBFN0VBO2JvcmRlci1sZWZ0OjA7Ym9yZGVyLXJpZ2h0OjA7Zm9udC1mYW1pbHk6VmVyZGFuYSwgc2Fucy1zZXJpZjtmb250LXNpemU6MTNwdDt9IC5iYXR0bGUtbG9nIC5jaGF0IHt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7cGFkZGluZzozcHggMCAzcHggMDtmb250LXNpemU6OHB0O30gLmJhdHRsZS1sb2cgLmNoYXQgc3Ryb25nIHtjb2xvcjojNDA1NzZBO30gLmJhdHRsZS1sb2cgLmNoYXQgZW0ge3BhZGRpbmc6MXB4IDRweCAxcHggM3B4O2NvbG9yOiMwMDAwMDA7Zm9udC1zdHlsZTpub3JtYWw7fSAuY2hhdC5taW5lIHtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsMC4wNSk7bWFyZ2luLWxlZnQ6LThweDttYXJnaW4tcmlnaHQ6LThweDtwYWRkaW5nLWxlZnQ6OHB4O3BhZGRpbmctcmlnaHQ6OHB4O30gLnNwb2lsZXIge2NvbG9yOiNCQkJCQkI7YmFja2dyb3VuZDojQkJCQkJCO3BhZGRpbmc6MHB4IDNweDt9IC5zcG9pbGVyOmhvdmVyLCAuc3BvaWxlcjphY3RpdmUsIC5zcG9pbGVyLXNob3duIHtjb2xvcjojMDAwMDAwO2JhY2tncm91bmQ6I0UyRTJFMjtwYWRkaW5nOjBweCAzcHg7fSAuc3BvaWxlciBhIHtjb2xvcjojQkJCQkJCO30gLnNwb2lsZXI6aG92ZXIgYSwgLnNwb2lsZXI6YWN0aXZlIGEsIC5zcG9pbGVyLXNob3duIGEge2NvbG9yOiMyMjg4Q0M7fSAuY2hhdCBjb2RlLCAuY2hhdCAuc3BvaWxlcjpob3ZlciBjb2RlLCAuY2hhdCAuc3BvaWxlcjphY3RpdmUgY29kZSwgLmNoYXQgLnNwb2lsZXItc2hvd24gY29kZSB7Ym9yZGVyOjFweCBzb2xpZCAjQzBDMEMwO2JhY2tncm91bmQ6I0VFRUVFRTtjb2xvcjpibGFjaztwYWRkaW5nOjAgMnB4O30gLmNoYXQgLnNwb2lsZXIgY29kZSB7Ym9yZGVyOjFweCBzb2xpZCAjQ0NDQ0NDO2JhY2tncm91bmQ6I0NDQ0NDQztjb2xvcjojQ0NDQ0NDO30gLmJhdHRsZS1sb2cgLnJhdGVkIHtwYWRkaW5nOjNweCA0cHg7fSAuYmF0dGxlLWxvZyAucmF0ZWQgc3Ryb25nIHtjb2xvcjp3aGl0ZTtiYWNrZ3JvdW5kOiM4OUE7cGFkZGluZzoxcHggNHB4O2JvcmRlci1yYWRpdXM6NHB4O30gLnNwYWNlciB7bWFyZ2luLXRvcDowLjVlbTt9IC5tZXNzYWdlLWFubm91bmNlIHtiYWNrZ3JvdW5kOiM2Njg4QUE7Y29sb3I6d2hpdGU7cGFkZGluZzoxcHggNHB4IDJweDt9IC5tZXNzYWdlLWFubm91bmNlIGEsIC5icm9hZGNhc3QtZ3JlZW4gYSwgLmJyb2FkY2FzdC1ibHVlIGEsIC5icm9hZGNhc3QtcmVkIGEge2NvbG9yOiNEREVFRkY7fSAuYnJvYWRjYXN0LWdyZWVuIHtiYWNrZ3JvdW5kLWNvbG9yOiM1NTk5NTU7Y29sb3I6d2hpdGU7cGFkZGluZzoycHggNHB4O30gLmJyb2FkY2FzdC1ibHVlIHtiYWNrZ3JvdW5kLWNvbG9yOiM2Njg4QUE7Y29sb3I6d2hpdGU7cGFkZGluZzoycHggNHB4O30gLmluZm9ib3gge2JvcmRlcjoxcHggc29saWQgIzY2ODhBQTtwYWRkaW5nOjJweCA0cHg7fSAuaW5mb2JveC1saW1pdGVkIHttYXgtaGVpZ2h0OjIwMHB4O292ZXJmbG93OmF1dG87b3ZlcmZsb3cteDpoaWRkZW47fSAuYnJvYWRjYXN0LXJlZCB7YmFja2dyb3VuZC1jb2xvcjojQUE1NTQ0O2NvbG9yOndoaXRlO3BhZGRpbmc6MnB4IDRweDt9IC5tZXNzYWdlLWxlYXJuLWNhbmxlYXJuIHtmb250LXdlaWdodDpib2xkO2NvbG9yOiMyMjg4MjI7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZTt9IC5tZXNzYWdlLWxlYXJuLWNhbm5vdGxlYXJuIHtmb250LXdlaWdodDpib2xkO2NvbG9yOiNDQzIyMjI7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZTt9IC5tZXNzYWdlLWVmZmVjdC13ZWFrIHtmb250LXdlaWdodDpib2xkO2NvbG9yOiNDQzIyMjI7fSAubWVzc2FnZS1lZmZlY3QtcmVzaXN0IHtmb250LXdlaWdodDpib2xkO2NvbG9yOiM2Njg4QUE7fSAubWVzc2FnZS1lZmZlY3QtaW1tdW5lIHtmb250LXdlaWdodDpib2xkO2NvbG9yOiM2NjY2NjY7fSAubWVzc2FnZS1sZWFybi1saXN0IHttYXJnaW4tdG9wOjA7bWFyZ2luLWJvdHRvbTowO30gLm1lc3NhZ2UtdGhyb3R0bGUtbm90aWNlLCAubWVzc2FnZS1lcnJvciB7Y29sb3I6Izk5MjIyMjt9IC5tZXNzYWdlLW92ZXJmbG93LCAuY2hhdCBzbWFsbC5tZXNzYWdlLW92ZXJmbG93IHtmb250LXNpemU6MHB0O30gLm1lc3NhZ2Utb3ZlcmZsb3c6OmJlZm9yZSB7Zm9udC1zaXplOjlwdDtjb250ZW50OicuLi4nO30gLnN1YnRsZSB7Y29sb3I6IzNBNEE2Njt9DQo8L3N0eWxlPg0KPHNjcmlwdCBzcmM9Imh0dHBzOi8vY29kZS5qcXVlcnkuY29tL2pxdWVyeS0zLjcuMS5taW4uanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+DQo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jb2RlLmpxdWVyeS5jb20vdWkvMS4xMy4xL2pxdWVyeS11aS5taW4uanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQp3aW5kb3cuQ29uZmlnID0gew0KICAgIHdoaXRlbGlzdDogW10sDQp9Ow0KPC9zY3JpcHQ+DQo8L2hlYWQ+DQo8Ym9keT4NCjxkaXYgY2xhc3M9IndyYXBwZXIgcmVwbGF5LXdyYXBwZXIiIHN0eWxlPSJtYXgtd2lkdGg6MTE4MHB4O21hcmdpbjowIGF1dG8iPg0KPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0icmVwbGF5aWQiIHZhbHVlPSJnZW45cmFuZG9tYmF0dGxlLTE4NTY5MTU5NDMtc3lpM2FpbnEwcXJtaG52OXdmd2dwaWhyeTg5eTh0NnB3IiAvPg0KPGRpdiBjbGFzcz0iYmF0dGxlIj48L2Rpdj48ZGl2IGNsYXNzPSJiYXR0bGUtbG9nIj48L2Rpdj48ZGl2IGNsYXNzPSJyZXBsYXktY29udHJvbHMiPjwvZGl2PjxkaXYgY2xhc3M9InJlcGxheS1jb250cm9scy0yIj48L2Rpdj4NCjxzY3JpcHQgdHlwZT0idGV4dC9wbGFpbiIgY2xhc3M9ImJhdHRsZS1sb2ctZGF0YSI+JHtCQVRUTEVfTE9HfTwvc2NyaXB0Pg0KPC9kaXY+DQo8L2Rpdj4NCjxzY3JpcHQ+DQpsZXQgZGFpbHkgPSBNYXRoLmZsb29yKERhdGUubm93KCkvMTAwMC82MC82MC8yNCk7ZG9jdW1lbnQud3JpdGUoJzxzY3JpcHQgc3JjPSJodHRwczovL3BsYXkucG9rZW1vbnNob3dkb3duLmNvbS9qcy9yZXBsYXktZW1iZWQuanM/dmVyc2lvbicrZGFpbHkrJyI+PC8nKydzY3JpcHQ+Jyk7DQo8L3NjcmlwdD4NCjwvYm9keT4NCjwvaHRtbD4=');

function escapeHTML(html) {
    return ("" + html).replace(/&/g, "&amp;").replace(/</g, "&lt;")
        .replace(/>/g, "&gt;").replace(/"/g, "&quot;")
        .replace(/'/g, "&apos;");
}

function generateHTML(log) {
    return TemplateHTML.replace("${BATTLE_LOG}", log);
}

function setReplay(log) {
    var html = generateHTML(log);

    var url = "data:text/html;charset=utf-8," + encodeURIComponent(html);

    var container = document.querySelector(".iframe-result-container");

    container.innerHTML = '<iframe src="' + url + '" referrerpolicy="no-referrer" allow="fullscreen"></iframe>';
}

document.addEventListener("DOMContentLoaded", function () {
    var battleId = window.REPLAY_ID + "";

    fetch("/battlelog/" + encodeURIComponent(battleId) + ".log")
        .then(function (response) {
            if (response.status !== 200) {
                var container = document.querySelector(".iframe-result-container");
                container.innerHTML = '<span>' + escapeHTML("Error: Battle log not found") + '</span>';
                return;
            }

            response.text().then(function (log) {
                setReplay(log);
            }).catch(function (err) {
                var container = document.querySelector(".iframe-result-container");
                container.innerHTML = '<span>' + escapeHTML("Error: " + err.message) + '</span>';
            });
        })
        .catch(function (err) {
            var container = document.querySelector(".iframe-result-container");
            container.innerHTML = '<span>' + escapeHTML("Error: " + err.message) + '</span>';
        });
});
