// Log to replay

window.TemplateHTML = atob('PCFET0NUWVBFIGh0bWw+DQo8bWV0YSBjaGFyc2V0PSJ1dGYtOCIgLz4NCjwhLS0gdmVyc2lvbiAxIC0tPg0KPHRpdGxlPkJhdHRsZSBSZXBsYXk8L3RpdGxlPg0KPHN0eWxlPg0KaHRtbCxib2R5IHtmb250LWZhbWlseTpWZXJkYW5hLCBzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxMHB0O21hcmdpbjowO3BhZGRpbmc6MDt9Ym9keXtwYWRkaW5nOjEycHggMDt9IC5iYXR0bGUtbG9nIHtmb250LWZhbWlseTpWZXJkYW5hLCBzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxMHB0O30gLmJhdHRsZS1sb2ctaW5saW5lIHtib3JkZXI6MXB4IHNvbGlkICNBQUFBQUE7YmFja2dyb3VuZDojRUVGMkY1O2NvbG9yOmJsYWNrO21heC13aWR0aDo2NDBweDttYXJnaW46MCBhdXRvIDgwcHg7cGFkZGluZy1ib3R0b206NXB4O30gLmJhdHRsZS1sb2cgLmlubmVyIHtwYWRkaW5nOjRweCA4cHggMHB4IDhweDt9IC5iYXR0bGUtbG9nIC5pbm5lci1wcmVlbXB0IHtwYWRkaW5nOjAgOHB4IDRweCA4cHg7fSAuYmF0dGxlLWxvZyAuaW5uZXItYWZ0ZXIge21hcmdpbi10b3A6MC41ZW07fSAuYmF0dGxlLWxvZyBoMiB7bWFyZ2luOjAuNWVtIC04cHg7cGFkZGluZzo0cHggOHB4O2JvcmRlcjoxcHggc29saWQgI0FBQUFBQTtiYWNrZ3JvdW5kOiNFMEU3RUE7Ym9yZGVyLWxlZnQ6MDtib3JkZXItcmlnaHQ6MDtmb250LWZhbWlseTpWZXJkYW5hLCBzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxM3B0O30gLmJhdHRsZS1sb2cgLmNoYXQge3ZlcnRpY2FsLWFsaWduOm1pZGRsZTtwYWRkaW5nOjNweCAwIDNweCAwO2ZvbnQtc2l6ZTo4cHQ7fSAuYmF0dGxlLWxvZyAuY2hhdCBzdHJvbmcge2NvbG9yOiM0MDU3NkE7fSAuYmF0dGxlLWxvZyAuY2hhdCBlbSB7cGFkZGluZzoxcHggNHB4IDFweCAzcHg7Y29sb3I6IzAwMDAwMDtmb250LXN0eWxlOm5vcm1hbDt9IC5jaGF0Lm1pbmUge2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjA1KTttYXJnaW4tbGVmdDotOHB4O21hcmdpbi1yaWdodDotOHB4O3BhZGRpbmctbGVmdDo4cHg7cGFkZGluZy1yaWdodDo4cHg7fSAuc3BvaWxlciB7Y29sb3I6I0JCQkJCQjtiYWNrZ3JvdW5kOiNCQkJCQkI7cGFkZGluZzowcHggM3B4O30gLnNwb2lsZXI6aG92ZXIsIC5zcG9pbGVyOmFjdGl2ZSwgLnNwb2lsZXItc2hvd24ge2NvbG9yOiMwMDAwMDA7YmFja2dyb3VuZDojRTJFMkUyO3BhZGRpbmc6MHB4IDNweDt9IC5zcG9pbGVyIGEge2NvbG9yOiNCQkJCQkI7fSAuc3BvaWxlcjpob3ZlciBhLCAuc3BvaWxlcjphY3RpdmUgYSwgLnNwb2lsZXItc2hvd24gYSB7Y29sb3I6IzIyODhDQzt9IC5jaGF0IGNvZGUsIC5jaGF0IC5zcG9pbGVyOmhvdmVyIGNvZGUsIC5jaGF0IC5zcG9pbGVyOmFjdGl2ZSBjb2RlLCAuY2hhdCAuc3BvaWxlci1zaG93biBjb2RlIHtib3JkZXI6MXB4IHNvbGlkICNDMEMwQzA7YmFja2dyb3VuZDojRUVFRUVFO2NvbG9yOmJsYWNrO3BhZGRpbmc6MCAycHg7fSAuY2hhdCAuc3BvaWxlciBjb2RlIHtib3JkZXI6MXB4IHNvbGlkICNDQ0NDQ0M7YmFja2dyb3VuZDojQ0NDQ0NDO2NvbG9yOiNDQ0NDQ0M7fSAuYmF0dGxlLWxvZyAucmF0ZWQge3BhZGRpbmc6M3B4IDRweDt9IC5iYXR0bGUtbG9nIC5yYXRlZCBzdHJvbmcge2NvbG9yOndoaXRlO2JhY2tncm91bmQ6Izg5QTtwYWRkaW5nOjFweCA0cHg7Ym9yZGVyLXJhZGl1czo0cHg7fSAuc3BhY2VyIHttYXJnaW4tdG9wOjAuNWVtO30gLm1lc3NhZ2UtYW5ub3VuY2Uge2JhY2tncm91bmQ6IzY2ODhBQTtjb2xvcjp3aGl0ZTtwYWRkaW5nOjFweCA0cHggMnB4O30gLm1lc3NhZ2UtYW5ub3VuY2UgYSwgLmJyb2FkY2FzdC1ncmVlbiBhLCAuYnJvYWRjYXN0LWJsdWUgYSwgLmJyb2FkY2FzdC1yZWQgYSB7Y29sb3I6I0RERUVGRjt9IC5icm9hZGNhc3QtZ3JlZW4ge2JhY2tncm91bmQtY29sb3I6IzU1OTk1NTtjb2xvcjp3aGl0ZTtwYWRkaW5nOjJweCA0cHg7fSAuYnJvYWRjYXN0LWJsdWUge2JhY2tncm91bmQtY29sb3I6IzY2ODhBQTtjb2xvcjp3aGl0ZTtwYWRkaW5nOjJweCA0cHg7fSAuaW5mb2JveCB7Ym9yZGVyOjFweCBzb2xpZCAjNjY4OEFBO3BhZGRpbmc6MnB4IDRweDt9IC5pbmZvYm94LWxpbWl0ZWQge21heC1oZWlnaHQ6MjAwcHg7b3ZlcmZsb3c6YXV0bztvdmVyZmxvdy14OmhpZGRlbjt9IC5icm9hZGNhc3QtcmVkIHtiYWNrZ3JvdW5kLWNvbG9yOiNBQTU1NDQ7Y29sb3I6d2hpdGU7cGFkZGluZzoycHggNHB4O30gLm1lc3NhZ2UtbGVhcm4tY2FubGVhcm4ge2ZvbnQtd2VpZ2h0OmJvbGQ7Y29sb3I6IzIyODgyMjt0ZXh0LWRlY29yYXRpb246dW5kZXJsaW5lO30gLm1lc3NhZ2UtbGVhcm4tY2Fubm90bGVhcm4ge2ZvbnQtd2VpZ2h0OmJvbGQ7Y29sb3I6I0NDMjIyMjt0ZXh0LWRlY29yYXRpb246dW5kZXJsaW5lO30gLm1lc3NhZ2UtZWZmZWN0LXdlYWsge2ZvbnQtd2VpZ2h0OmJvbGQ7Y29sb3I6I0NDMjIyMjt9IC5tZXNzYWdlLWVmZmVjdC1yZXNpc3Qge2ZvbnQtd2VpZ2h0OmJvbGQ7Y29sb3I6IzY2ODhBQTt9IC5tZXNzYWdlLWVmZmVjdC1pbW11bmUge2ZvbnQtd2VpZ2h0OmJvbGQ7Y29sb3I6IzY2NjY2Njt9IC5tZXNzYWdlLWxlYXJuLWxpc3Qge21hcmdpbi10b3A6MDttYXJnaW4tYm90dG9tOjA7fSAubWVzc2FnZS10aHJvdHRsZS1ub3RpY2UsIC5tZXNzYWdlLWVycm9yIHtjb2xvcjojOTkyMjIyO30gLm1lc3NhZ2Utb3ZlcmZsb3csIC5jaGF0IHNtYWxsLm1lc3NhZ2Utb3ZlcmZsb3cge2ZvbnQtc2l6ZTowcHQ7fSAubWVzc2FnZS1vdmVyZmxvdzo6YmVmb3JlIHtmb250LXNpemU6OXB0O2NvbnRlbnQ6Jy4uLic7fSAuc3VidGxlIHtjb2xvcjojM0E0QTY2O30NCjwvc3R5bGU+DQo8ZGl2IGNsYXNzPSJ3cmFwcGVyIHJlcGxheS13cmFwcGVyIiBzdHlsZT0ibWF4LXdpZHRoOjExODBweDttYXJnaW46MCBhdXRvIj4NCjxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InJlcGxheWlkIiB2YWx1ZT0iZ2VuOXJhbmRvbWJhdHRsZS0xODU2OTE1OTQzLXN5aTNhaW5xMHFybWhudjl3ZndncGlocnk4OXk4dDZwdyIgLz4NCjxkaXYgY2xhc3M9ImJhdHRsZSI+PC9kaXY+PGRpdiBjbGFzcz0iYmF0dGxlLWxvZyI+PC9kaXY+PGRpdiBjbGFzcz0icmVwbGF5LWNvbnRyb2xzIj48L2Rpdj48ZGl2IGNsYXNzPSJyZXBsYXktY29udHJvbHMtMiI+PC9kaXY+DQo8c2NyaXB0IHR5cGU9InRleHQvcGxhaW4iIGNsYXNzPSJiYXR0bGUtbG9nLWRhdGEiPiR7QkFUVExFX0xPR308L3NjcmlwdD4NCjwvZGl2Pg0KPC9kaXY+DQo8c2NyaXB0Pg0KbGV0IGRhaWx5ID0gTWF0aC5mbG9vcihEYXRlLm5vdygpLzEwMDAvNjAvNjAvMjQpO2RvY3VtZW50LndyaXRlKCc8c2NyaXB0IHNyYz0iaHR0cHM6Ly9wbGF5LnBva2Vtb25zaG93ZG93bi5jb20vanMvcmVwbGF5LWVtYmVkLmpzP3ZlcnNpb24nK2RhaWx5KyciPjwvJysnc2NyaXB0PicpOw0KPC9zY3JpcHQ+');

function escapeHTML(html) {
    return ("" + html).replace(/&/g, "&amp;").replace(/</g, "&lt;")
        .replace(/>/g, "&gt;").replace(/"/g, "&quot;")
        .replace(/'/g, "&apos;");
}

function generateHTML(log) {
    return TemplateHTML.replace("${BATTLE_LOG}", log);
}

function setReplay(log) {
    var html = generateHTML(log);

    var url = "data:text/html;charset=utf-8," + encodeURIComponent(html);

    var container = document.querySelector(".iframe-result-container");

    container.innerHTML = '<iframe src="' + url + '" referrerpolicy="no-referrer" allow="fullscreen"></iframe>';
}

document.addEventListener("DOMContentLoaded", function () {
    var battleId = window.REPLAY_ID + "";

    fetch("/battlelog/" + encodeURIComponent(battleId) + ".log")
        .then(function (response) {
            if (response.status !== 200) {
                var container = document.querySelector(".iframe-result-container");
                container.innerHTML = '<span>' + escapeHTML("Error: Battle log not found") + '</span>';
                return;
            }

            response.text().then(function (log) {
                setReplay(log);
            }).catch(function (err) {
                var container = document.querySelector(".iframe-result-container");
                container.innerHTML = '<span>' + escapeHTML("Error: " + err.message) + '</span>';
            });
        })
        .catch(function (err) {
            var container = document.querySelector(".iframe-result-container");
            container.innerHTML = '<span>' + escapeHTML("Error: " + err.message) + '</span>';
        });
});
